---
title: Придание надстройке, размещаемой у поставщика, внешнего вида и удобства использования SharePoint
ms.prod: SHAREPOINT
ms.assetid: 53bf456d-a832-4b43-8ccd-42e4dab81dfc
---


# Придание надстройке, размещаемой у поставщика, внешнего вида и удобства использования SharePoint
В данной статье рассказывается, как придать Надстройки SharePoint, размещаемым у поставщика, внешний вид и удобство использования SharePoint.
Это вторая часть из серии статей о том, как разрабатывать Надстройки SharePoint, размещаемые у поставщика. Сначала вам необходимо ознакомиться со статьей  [Надстройки SharePoint](sharepoint-add-ins.md) и с указанными ниже предыдущими статьями серии.
  
    
    


-  [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins.md)
    
  

Из предыдущей статьи этой серии вы узнали, как настраивать среду разработки и использовать Visual Studio для создания первой надстройки начального уровня, предоставляющей данные SharePoint удаленному веб-приложению надстройки. В данной статье мы собираемся начать работу с уже созданного решения Надстройка SharePoint. Оно включает приложение веб-форм ASP.NET и базу данных SQL Azure. Мы создали их для вас, так как в этой серии статей мы сконцентрируемся только на Надстройки SharePoint. При изучении каждой статьи серии вы будете добавлять в надстройку дополнительные функции SharePoint и увеличивать степень ее интеграции с SharePoint.
  
    
    


## Знакомство с базовой надстройкой

В этой серии статей мы не будем учить вас программированию для ASP.NET или T-SQL, но у вас должны быть базовые знания об удаленных компонентах надстройки, прежде чем мы начнем интегрировать ее в SharePoint. Надстройка предназначена для сети розничных магазинов, при этом подразумевается, что у каждого магазина имеется веб-сайт группы в подписке родительской компании на SharePoint Online. Когда магазин устанавливает надстройку на своем сайте группы, она позволяет ему интегрировать данные и интерфейс SharePoint магазина с данными, размещенными в базе данных родительской компании. У каждого экземпляра надстройки имеется собственная область в корпоративной базе данных, при этом пользователи могут взаимодействовать только с корпоративными данными, сопоставленными с их магазином.
  
    
    

### Начало работы путем создания сайтов групп для двух магазинов сети


1. Откройте начальную страницу SharePoint Online и на панели быстрого запуска щелкните ссылку **Содержание сайта**. Прокрутите страницу **Содержание сайта** вниз до ссылки **создать дочерний сайт**.
    
  
2. На странице **Создание сайта SharePoint** заполните форму для нового сайта группы, используя значения с указанного ниже снимка экрана.
    
!\[Форма для создания дочернего сайта SharePoint с текстом "Fabrikam Hong Kong Store" в текстовом поле "Название" и текстом "hongkong" в текстовом поле URL-адреса.](images/7639578e-3d3f-40cf-8f53-355bb19c539b.png)
  

  

  
3. Для всех остальных параметров оставьте значения, используемые по умолчанию, и нажмите кнопку **Создать**.
    
  

### Изучение надстройки


1. Перейдите на веб-страницу  [SharePoint_Provider-hosted_Add-Ins_Tutorials](https://github.com/OfficeDev/SharePoint_Provider-hosted_Add-ins_Tutorials) и нажмите кнопку **Download ZIP** (Скачать ZIP-файл), чтобы скачать репозиторий на ваш компьютер. Распакуйте файл.
    
  
2. Запустите Visual Studio *от имени администратора*  , а затем откройте файл BeforeSharePointUI.sln. В решении имеются три указанных ниже проекта.
    
  - **ChainStore**  проект Надстройка SharePoint.
    
  
  - **ChainStoreWeb**  удаленное веб-приложение.
    
  
  - **ChainCorporateDB**  база данных SQL Azure.
    
  
3. Выберите проект **ChainStore** и в окне **Свойства** укажите для свойства **URL-адрес сайта** полный URL-адрес сайта группы в Гонконге:https://{ВАШ_ДОМЕН_SHAREPOINT}/hongkong/. Не забудьте в конце адреса поставить символ /. Нажмите кнопку **Сохранить**.  *На определенном моменте этого процесса вам будет предложено войти в вашу подписку SharePoint Online.* 
    
  
4. В верхней части **обозревателя решений** щелкните правой кнопкой мыши узел решения и выберите **Назначить запускаемые проекты**.
    
  
5. Убедитесь, что в столбце **Действие** для всех трех проектов указано значение **Запускать**.
    
  
6. Нажмите клавишу F5, чтобы развернуть и запустить вашу надстройку. Visual Studio размещает удаленное веб-приложение в IIS Express, а базу данных SQL  в SQL Express. Кроме того, он создает временную установку надстройки на вашем тестовом сайте SharePoint и сразу же запускает ее. Прежде чем откроется начальная страница надстройки, вам будет предложено предоставить надстройке необходимые разрешения.
    
  
7. На снимке экрана ниже показано, как выглядит начальная страница надстройки. В самом верху указано имя веб-сайта SharePoint, на котором установлена надстройка. Это побочный эффект работы примера кода, создаваемого Инструменты разработчика Office для Visual Studio. Вы исправите это на одном из следующих этапов. На странице имеются области, в которых отображаются данные из таблиц **Inventory** (Запасы), **Orders** (Заказы) и **Employees** (Сотрудники) корпоративной базы данных SQL. Изначально эти таблицы пусты.
    
!\[Начальная страница надстройки сетевого магазина с помеченными областями и кнопками для просмотра сведений о запасах, заказах и сотрудниках магазина.](images/9c836899-8f21-4e0f-9260-69b8171a303c.PNG)
  

  

  
8. Чтобы открыть форму заказа, щелкните ссылку **Order Form** (Форма заказа) в нижней части страницы. Введите необходимые значения в форму и нажмите кнопку **Place Order** (Разместить заказ). Пример вводимых значений показан на снимке экрана ниже. Несмотря на то что не будет отображено никакого уведомления, код кнопки передаст эти значения в параметризированную хранимую процедуру в базе данных SQL. Использование таких процедур позволяет защитить базу данных от атак путем внедрения кода SQL.
    
!\[Форма заказа с текстовыми полями для поставщика, продукта и количества и кнопкой с надписью "Заказать".](images/5ce3e68b-1bcf-4a24-9153-b9164af77a6b.PNG)
  

  

  
9. С помощью кнопки "Назад" в браузере вернитесь обратно на начальную страницу, а затем нажмите кнопку **Show Orders** (Показать заказы). Страница обновится и на ней отобразится ваш заказ, как показано на снимке экрана ниже.
    
    В таблице имеется поле **Tenant** (Клиент), в котором записан URL-адрес вашего тестового веб-сайта SharePoint. Это не имеет отношения к подписке на SharePoint Online, которую иногда называют тенантностью. Вместо этого каждый экземпляр надстройки представляет собой отдельный клиент в корпоративной базе данных. Так как на один хост-сайт SharePoint допускается устанавливать не более одного экземпляра надстройки, то можно использовать URL-адрес хост-сайта в качестве дискриминатора клиента в базе данных. (Сведения о различиях между хост-сайтом и сайтом надстройки см. в статье [Надстройки SharePoint](sharepoint-add-ins.md).) При операциях записи в базу данных или чтения из нее все хранимые процедуры в надстройке включают значение дискриминатора. Это гарантирует, что когда пользователь нажимает кнопку **Show Orders** (Показать заказы), **Show Employees** (Показать сотрудников) или **Show Inventory** (Показать запасы), из базы данных будут получены только те данные, которые сопоставлены с магазином пользователя. Эта конструкция также гарантирует, что пользователи смогут размещать заказы и добавлять сотрудников только для своего магазина.
    
    Удаленное веб-приложение получает URL-адрес хост-сайта из параметра строки запроса, который SharePoint добавляет в URL-адрес начальной страницы, когда запускает надстройку. Так как используется SSL, то эта строка передается на удаленное веб-приложение через Интернет в зашифрованном виде. 
    
!\[Раздел начальной страницы для заказов с одним заказом, отображаемым в HTML-таблице. Содержит столбцы идентификатора, клиента, поставщика, продукта и количества.](images/6a82c6eb-4a46-4a97-94f9-c1f4a7605d1f.PNG)
  

  

  
10. Чтобы завершить сеанс отладки, закройте окно браузера или остановите отладку в Visual Studio. При каждом нажатии клавиши F5 Visual Studio будет отзывать предыдущую версию надстройки и устанавливать ее последнюю версию.
    
  
11. По умолчанию между сеансами отладки в Visual Studio надстройка остается установленной на хост-сайте SharePoint. Чтобы посмотреть, как конечные пользователи могут запускать ее после установки, в браузере откройте веб-сайт SharePoint компании Fabrikam в Гонконге и перейдите на страницу **Site Contents** (Содержание сайта). Будет отображено название надстройки, как показано на снимке экрана ниже.
    
!\[Плитка запуска надстройки сетевого магазина на странице содержания сайта со значком и именем надстройки.](images/f16e6360-c511-431f-b2c5-9e5541e64d4b.PNG)
  

    
    > **Примечание**
      > Если вы щелкните плитку, начальная страница не откроется, потому что когда вы останавливаете отладку, Visual Studio закрывает сеанс IIS Express. 

## Настройка Visual Studio для перестройки корпоративной базы данных при каждом сеансе отладки
<a name="Rebuild"> </a>

 По умолчанию Visual Studio *не*  перестраивает базу данных SQL Express. Таким образом, заказы и другие элементы, которые вы добавили в базу данных в сеансе отладки, останутся в ней и для следующих сеансов. Гораздо удобнее при каждом нажатии клавиши F5 начинать работу с пустой базой данных, поэтому выполните указанные ниже действия.
  
    
    

1. Щелкните правой кнопкой мыши проект **ChainCorporateDB** и выберите пункт **Свойства**.
    
  
2. Откройте вкладку **Отладка** и включите параметр **Всегда повторно создавать базу данных**.
    
  

## Придание удаленному веб-приложению внешнего вида и удобства использования SharePoint
<a name="Rebuild"> </a>

Иногда необходимо, чтобы удаленные страницы имели собственную фирменную символику, но в большинстве случаев они должны имитировать пользовательский интерфейс SharePoint, чтобы пользователи полагали, что они по-прежнему работают с SharePoint.
  
    
    

### Добавление хрома и верхней панели SharePoint на начальную страницу


1. В **обозревателе решений** перейдите к **ChainStoreWeb | Страницы** и откройте файл CorporateDataViewer.aspx. Это начальная страница надстройки.
    
  
2. В разделе **head** отобразится сценарий, который загружает пару библиотек JavaScript. Сразу же после него вставьте указанный ниже сценарий. Он загружает файл SP.UI.Controls.js, который имеется на всех веб-сайтах SharePoint в папке /_layouts/15/. Помимо прочего, этот файл загружает библиотеку CSS SharePoint.
    
 ```
  
<script type="text/javascript">
    var hostweburl;

    // Load the SharePoint resources.
    $(document).ready(function () {

        // Get the URI decoded add-in web URL.
        hostweburl =
            decodeURIComponent(
                getQueryStringParameter("SPHostUrl")
        );

        // The SharePoint js files URL are in the form:
        // web_url/_layouts/15/resource.js
        var scriptbase = hostweburl + "/_layouts/15/";

        // Load the js file and continue to the 
        // success handler.
        $.getScript(scriptbase + "SP.UI.Controls.js")
    });

    // Function to retrieve a query string value.
    function getQueryStringParameter(paramToRetrieve) {
        var params =
            document.URL.split("?")[1].split("&amp;");
        var strParams = "";
        for (var i = 0; i < params.length; i = i + 1) {
            var singleParam = params[i].split("=");
            if (singleParam[0] == paramToRetrieve)
                return singleParam[1];
        }
    }
</script>
 ```

3. В верхней части раздела body страницы добавьте указанную ниже разметку. Это позволит добавить на страницу верхнюю панель SharePoint, называемую элемент управления хрома. Подробности этой разметки станут более понятными, когда далее в этой статье мы протестируем измененную надстройку. (Так как ранее надстройки назывались приложениями, в некоторых именах свойств отображается слово app.)
    
 ```
  
<!-- Chrome control placeholder. Options are declared inline.  -->
<div 
    id="chrome_ctrl_container"
    data-ms-control="SP.UI.Controls.Navigation"  
    data-ms-options=
        '{  
            "appHelpPageUrl" : "Help.aspx",
            "appIconUrl" : "/Images/AppIcon.png",
            "appTitle" : "Chain Store",
            "settingsLinks" : [
                {
                    "linkUrl" : "Account.aspx",
                    "displayName" : "Account settings"
                },
                {
                    "linkUrl" : "Contact.aspx",
                    "displayName" : "Contact us"
                }
            ]
         }'>
</div>
 ```

4. Заголовки **H1** и ссылка в разделе body страницы автоматически будут использовать стили, определенные в библиотеке CSS SharePoint, поэтому не нужно их изменять. Для иллюстрации того, как использовать стили SharePoint, задайте для заголовков столбцов в трех элементах управления **GridView** стиль SharePoint "Прописные буквы", добавив атрибут **HeaderStyle-CssClass** к каждому элементу управления и присвоив ему значение `ms-uppercase`. Ниже приведен пример такого кода. Внесите такие же изменения во все три элемента управления **GridView**.
    
 ```XML
  
<asp:GridView ID="ordersGridView" runat="server" CellPadding="5" GridLines="None"
HeaderStyle-CssClass="ms-uppercase" />
 ```

5. Элемент управления хрома использует значок надстройки, поэтому нам необходима вторая копия файла значка на удаленном веб-сервере. В **обозревателе решений** щелкните правой кнопкой мыши файл AppIcon.png в проекте **ChainStore** и выберите пункт **Копировать**. 
    
  
6. Щелкните правой кнопкой мыши папку **Images** (Изображения) в проекте **ChainStoreWeb** и выберите пункт **Вставить**.
    
  
7. Откройте файл CorporateDataViewer.aspx.cs.
    
  
8. Класс  `CorporateDataViewer` объявляет частный член типа **SharePointContext**. Этот класс определен в файле SharePointContext.cs, созданном Инструменты разработчика Office для Visual Studio при добавлении проекта. Вы можете считать его аналогом класса **HttpContextBase** в ASP.NET, в который добавлена контекстная информация SharePoint, например URL-адрес хост-сайта.
    
    В методе **Page_Load** имеется оператор **using**, который записывает имя хост-сайта SharePoint на удаленную начальную страницу. Это пример кода, поэтому целиком удалите оператор **using**. При этом оставьте строку, которая инициализирует переменную  `spContext`. Теперь этот метод должен выглядеть указанным ниже образом.
    


 ```cs
  
protected void Page_Load(object sender, EventArgs e)
{
    spContext = SharePointContextProvider.Current.GetSharePointContext(Context);
}
 ```

9. Для пользовательского интерфейса SharePoint необходимы четыре других указанных ниже файла ASP.NET. 
    
  - Account.aspx
    
  
  - Contact.aspx
    
  
  - Help.aspx
    
  
  - OrderForm.aspx
    
  

    > **Примечание**
      > Последний ASPX-файл в проекте (EmployeeAdder.aspx) фактически никогда не отрисовывается, поэтому не изменяйте его пользовательский интерфейс. Вы изучите этот файл более подробно в одной из следующих статей этой серии. 

    Нам не нужен элемент управления хрома на этих страницах. Мы только хотим получить доступ к библиотеке CSS SharePoint. В каждый из этих четырех файлов добавьте указанную ниже разметку в элемент **head**.
    


 ```XML
  
<link type="text/css" rel="stylesheet"
href="<%= spContext.SPHostUrl.ToString() + "_layouts/15/defaultcss.ashx" %>" />
 ```

10. Это и следующее за ним действия уже выполнены для страниц Order Form (Форма заказа) и Account (Учетная запись), поэтому необходимо выполнить их только для страниц Contact (Контакт) и Help (Справка). Чтобы получить объект  `spContext` для каждой страницы, откройте ASPX.CS-файлы кода программной части для трех ASPX-страниц. В каждом из них добавьте указанный ниже член в класс **Page**.
    
 ```cs
  
protected SharePointContext spContext;
 ```

11. Замените метод **Page_Load** указанной ниже версией. Объект извлекается из кэша сеанса. Он был помещен в кэш, когда был создан методом **Page_Load** начальной страницы надстройки.
    
 ```cs
  protected void Page_Load(object sender, EventArgs e)
{
    spContext = Session["SPContext"] as SharePointContext;
}
 ```

12. Откройте страницу OrderForm.aspx. В верхнем элементе **Label** замените элемент **<b>** в фразе **Place Order** (Разместить заказ) на теги span, ссылающиеся на класс CSS `ms-accentText`. После этого весь элемент управления **Label** должен иметь указанный ниже вид.
    
 ```XML
  
<asp:Label ID="lblOrderPrompt" runat="server"
         Text="Enter a supplier, product, and quantity; and then press <span class='ms-accentText'>Place Order</span>.">
</asp:Label>
 ```


## Запуск надстройки и тестирование нового пользовательского интерфейса SharePoint
<a name="Rebuild"> </a>


  
    
    

1. Нажмите клавишу F5, чтобы развернуть и запустить вашу надстройку. Visual Studio размещает удаленное веб-приложение в IIS Express, а базу данных SQL  в SQL Express. Кроме того, он создает временную установку надстройки на вашем тестовом сайте SharePoint и сразу же запускает ее. Прежде чем откроется начальная страница надстройки, вам будет предложено предоставить надстройке необходимые разрешения.
    
  
2. Когда откроется начальная страница надстройки, она будет выглядеть как страница SharePoint. Щелкните ссылку **Order Form** (Форма заказа). Теперь эта форма тоже выглядит как форма SharePoint.
    
!\[Еще одна форма заказа. В этой форме используются шрифты Segoe, а слово "Заказать" выделено синим цветом.](images/a35fd1af-7194-4c99-b298-bac97025b981.PNG)
  

  

  
3. Создайте заказ и нажмите кнопку **Place Order** (Разместить заказ).
    
  
4.  С помощью кнопки "Назад" в браузере вернитесь обратно на начальную страницу надстройки, а затем нажмите кнопку **Show Orders** (Показать заказы). Теперь эта страница должна выглядеть, как показано ниже. Обратите внимание, что теперь в заголовках столбцов используются только прописные буквы.
    
!\[Начальная страница с элементом управления хрома в верхней части. Весь текст и элементы управления имеют стиль SharePoint.](images/e56e4b80-1f1c-4a83-9ac0-3005ceea7c3a.PNG)
  

  

  
5. Щелкните по значку **?** в конце элемента управления хрома. Откроется простая страница Справки. Нажмите кнопку "Назад" в браузере.
    
  
6. Щелкните по значку с изображением шестеренки на элементе управления хрома. Откроется меню со ссылками на страницы Account (Учетная запись) и Contact (Контакт). Откройте страницу Account (Учетная запись) и с помощью кнопки "Назад" в браузере вернитесь на начальную страницу. Выполните такие же действия для страницы Contact (Контакт).
    
  
7. На элементе управления хрома нажмите кнопку **Back to Site** (Вернуться на сайт). Откроется начальная страница хост-сайта (сайт группы магазина в Гонконге).
    
  
8. Щелкните по значку с изображением шестеренки на верхней панели и выберите **Change the look** (Изменить вид).
    
  
9. Следуя инструкциям, выберите для сайта один из альтернативных вариантов оформления. 
    
  
10. Перейдите на страницу **Site Contents** (Содержание сайта) и запустите приложение Chain Store, щелкнув его плитку. Для ваших настраиваемых страниц будет использован выбранный вариант оформления. На снимках экрана ниже показано, как они выглядят при использовании оформления **Природа**.
    
!\[Начальная страница и форма заказа надстройки в зеленых цветах представления "Природа".](images/25ba5677-f530-432a-9980-64b5eb33119c.png)
  

  

  
11. Измените внешний вид сайта обратно на вид, используемый по умолчанию (он называется **Office**).
    
  
12. Чтобы завершить сеанс отладки, закройте окно браузера или остановите отладку в Visual Studio. При каждом нажатии клавиши F5 Visual Studio будет отзывать предыдущую версию надстройки и устанавливать ее последнюю версию.
    
  
13. Вы будете работать с этой надстройкой и решением Visual Studio и при изучении других статей, поэтому при перерывах в работе рекомендуется отзывать надстройку. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите пункт **Отозвать**.
    
  

## 
<a name="Nextsteps"> </a>

 Теперь надстройка выглядит как SharePoint. Тем не менее она по-прежнему является веб-приложением, которое на самом деле не интегрировано с SharePoint, хотя и запускается с помощью плитки в SharePoint. Вы добавите настраиваемую команду, запускаемую с помощью настраиваемой кнопки на ленте в следующей статье: [Включение настраиваемой кнопки в надстройку, размещаемую у поставщика](include-a-custom-button-in-the-provider-hosted-add-in.md).
  
    
    

