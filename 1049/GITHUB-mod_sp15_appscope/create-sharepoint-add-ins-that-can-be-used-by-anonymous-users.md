---
title: Создание надстроек для SharePoint, доступных анонимным пользователям
ms.prod: SHAREPOINT
ms.assetid: e858fce6-7a8f-4b1e-b053-64dc75345801
---


# Создание надстроек для SharePoint, доступных анонимным пользователям
Узнайте, как создать Надстройки SharePoint, с которыми могут работать анонимные пользователи на общедоступных сайтах Microsoft SharePoint 2013.
> **Важно!**
> При использовании термина " *локальная среда*  SharePoint 2013" в этой статье предполагается, что установлен пакет обновления 1 (SP1) для SharePoint 2013.





## Необходимые условия для создания Надстройки SharePoint, доступных анонимным пользователям

Анонимный доступ возможен для Надстройки SharePoint, размещенных в SharePoint и у поставщика. В зависимости от типа приложения изучите один из следующих наборов требований:




-  [](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md#SP15SPhostedapps_bk_prereqs)


-  [](get-started-creating-provider-hosted-sharepoint-add-ins.md#SP15createselfhostapp_bk_prereq)


Вам также потребуется семейство сайтов в тестовой установке SharePoint 2013, настроенной для анонимного доступа. Если у вас есть Сайт разработчиков Office 365, то уже существует связанное общедоступное семейство сайтов, использующее специальное определение общедоступного веб-сайта. (Дополнительные сведения об использовании общедоступных веб-сайтов в Microsoft SharePoint Online см. в статье  [Справка по общедоступному веб-сайту для Office 365](http://office.microsoft.com/ru-ru/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1).) Данное определение сайта недоступно для локальных установок SharePoint 2013, поэтому если ваша тестовая установка находится в локальной среде, вам потребуются следующие компоненты:




- Веб-приложение SharePoint, настроенное для предоставления анонимного доступа. Его необходимо настроить после установки тестируемого Надстройка SharePoint.


- Семейство веб-сайтов в веб-приложении, которое также настроено для предоставления анонимного доступа. Его необходимо настроить после установки тестируемого Надстройка SharePoint.


- Если ваша надстройка размещается в SharePoint и получает доступ к списку SharePoint, то необходим список в семействе сайтов, настроенный для анонимного доступа.


Инструкции для настройки этих компонентов представлены в разделе  [Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа](#Configuring).




## Ограничения по использованию надстроек для SharePoint анонимными пользователями

При проектировании Надстройка SharePoint необходимо учитывать следующее:




- Если Надстройка SharePoint запускается из SharePoint, оно должно содержать дополнительное действие, часть надстройки или должно запускаться с помощью настраиваемой ссылки на странице. Это связано с тем, что анонимные пользователи не могут запускать надстройку с помощью ее плитки. Для запуска надстроек с помощью плитки используется специальная  [страница приложения](http://msdn.microsoft.com/library/685c8e01-b163-4b5e-888c-421d9ecbb25e%28Office.15%29.aspx), недоступная анонимным пользователям. Другой вариант позволить запускать надстройку за пределами SharePoint, при этом требуется использовать политику авторизации только для надстройки.


- Анонимный пользователь может запускать только Надстройки SharePoint, установленные другими. Это связано с тем, что анонимные пользователи не могут открывать страницу **добавления надстройки**.


- Когда вошедший в систему пользователь переходит к веб-сайту в локальном веб-приложении SharePoint, настроенном для анонимного доступа, удостоверение пользователя меняется на **системную учетную запись**. С помощью этого удостоверения невозможно устанавливать Надстройки SharePoint. Так как анонимные пользователи также не могут устанавливать надстройки, это означает, что если веб-приложение настроено для анонимного доступа, никто не сможет установить Надстройки SharePoint. Соответственно, следует установить Надстройки SharePoint на веб-сайты в веб-приложении SharePoint до настройки анонимного доступа в веб-приложении. Чтобы установить другие надстройки позже, требуется временно отключить анонимный доступ в веб-приложении. Это позволит устанавливать надстройки только пользователю, вошедшему в систему.


- Чтобы разрешить использование интерфейсов API REST службы поиска SharePoint на локальном веб-сайте SharePoint, необходимо настроить XML запроса. Дополнительные сведения см. в статье о  [включении анонимных запросов поиска REST](http://msdn.microsoft.com/library/office/jj163876.aspx#bk_AnonymousREST).


- Данные на сайте надстройки не обходятся индексаторами поиска, поэтому пользовательские данные необходимо развернуть удаленно или на хост-сайте. Это относится ко всем Надстройки SharePoint, но мы решили упомянуть об этом, так как в приложениях с анонимным доступом часто требуются функции поиска.



## Создание размещенных у поставщика надстроек, доступных анонимным пользователям
<a name="Cloud-hosted"> </a>

Чтобы сделать размещаемую у поставщика надстройку доступной анонимным пользователям, нужно просто настроить ее для использования политики авторизации только для надстройки. При применении этой политики SharePoint даже не включает пользовательский контекст, поэтому не имеет значения, являются ли пользователи анонимными. Администратор клиента, который устанавливает надстройку, должен предоставить субъекту надстройки разрешения для хост-сайта (и любые разрешения для родительского семейства сайтов или родительского клиента). Как и для любых других надстроек, разрешения для доступа к хост-сайту запрашиваются в манифесте надстройки.




> **Примечание**
> Если сайт SharePoint доступен анонимным пользователям, то обычно на нем разрешен доступ по протоколу HTTP, а не HTTPS. В этом сценарии при использовании политики только для надстроек существуют потенциальные проблемы для безопасности. Дополнительные сведения и описание способа устранения таких проблем см. в записи блога  [о том, что каждый разработчик должен знать о приложениях SharePoint, CSOM и анонимных сайтах публикации](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx). 




При разработке надстройки, использующей политику только для надстроек, следует выполнить два указанных ниже действия.




- Необходимо добавить строку  `AllowAppOnlyPolicy="true"` в элемент **AppPermissionRequests** манифеста надстройки.


- Код должен запрашивать маркер доступа только для надстроек с сервера авторизации OAuth. Если вы работаете с управляемым кодом, существуют API-интерфейсы, предназначенные специально для этой цели и размещенные в файлах кода, созданных Инструменты разработчика Microsoft Office для Visual Studio: SharePointContext.cs (или с расширением VB) и TokenHelper.cs (или с расширением VB).


Дополнительные сведения о политике только для надстроек (с фрагментами кода), разрешениях для надстроек и манифесте надстройки см. в указанных ниже статьях.




-  [Типы политик авторизации для надстроек в SharePoint 2013](add-in-authorization-policy-types-in-sharepoint-2013.md)


-  [Разрешения для надстроек в SharePoint 2013](add-in-permissions-in-sharepoint-2013.md)


-  [Изучите структуру манифеста надстройки и пакет надстройки для SharePoint](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in.md)



## Создание размещенных в SharePoint надстроек, доступных анонимным пользователям
<a name="SP-hosted"> </a>

Для создания размещенной в SharePoint надстройки, которую могут запускать анонимные пользователи, не требуются специальные методики. Ее можно создать так же, как любую другую надстройку, размещенную в SharePoint. Дополнительные сведения см. в статьях  [Знакомство с созданием надстроек SharePoint с размещением в SharePoint](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md) и [Выполнение базовых операций с использованием кода библиотеки JavaScript в SharePoint 2013](complete-basic-operations-using-javascript-library-code-in-sharepoint-2013.md).



Для предоставления анонимным пользователям доступа к надстройке, размещенной в SharePoint, важно то, что семейство сайтов SharePoint Online настраивает администратор клиента, чтобы разрешить анонимный доступ. Разработчик надстройки не может выполнить такую настройку в надстройке, удаленном приемнике событий надстройки или в инфраструктуре установке надстройки для SharePoint. Вы можете добавить настраиваемый список или библиотеку в надстройку, но Язык CAML не предоставляет возможностей для предварительной настройки анонимного доступа. Поэтому его придется настроить после установки надстройки.



Если для продажи своей надстройки вы используете Магазин Office, и существенная часть потенциальных клиентов сочтет ее полезной при наличии доступа для анонимных пользователей, то в этом случае следует указать это требование в описании надстройки. Кроме того, рекомендуется добавить указанную ниже версию процедуры **настройки семейства сайтов SharePoint Online для анонимного доступа** на страницу поддержки вашей надстройки.



Если ваша надстройка использует объектную модель JavaScript (JSOM) в SharePoint, существует одно очень важное требование к конфигурации. По умолчанию анонимным пользователям доступна только малая часть API JSOM. Для доступа к другим API у пользователей должно быть разрешение на **использование удаленных интерфейсов**, которое отсутствует у анонимных пользователей. Это требование необходимо отключить в родительском семействе сайтов или родительском веб-приложении SharePoint веб-сайта, на котором установлена надстройка, как описано в разделе [Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа](#Configuring).




> **Примечание**
> Отключение требования наличия разрешения на **использование удаленных интерфейсов** у пользователей влияет на конфиденциальность информации. Дополнительные сведения см. в записи блога [о том, что каждый разработчик должен знать о приложениях SharePoint, CSOM и анонимных сайтах публикации](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx). 





## Ограничения надстроек, размещенных в SharePoint, для анонимных пользователей
<a name="SP-hosted"> </a>

Будем честны: для анонимных пользователей надстроек, размещенных в SharePoint, существуют значительные ограничения, о которых вам нужно знать.




- Невозможно сделать список или библиотеку в SharePoint Online доступными анонимным пользователям. Соответственно, API-интерфейсы JSOM, взаимодействующие со списками и библиотеками, не работают в SharePoint Online для анонимных пользователей.


- Размещенная в SharePoint надстройка, установленная на  *локальном*  веб-сайте SharePoint, может использовать все API JSOM. Тем не менее необходимо *вручную*  настроить веб-приложение, семейство сайтов и его списки и библиотеки для анонимного доступа, а требование наличия разрешения на **использование удаленных интерфейсов** следует отключить. Если надстройка устанавливает настраиваемые списки и библиотеки на сайт надстройки, то пользователям необходимо вручную настроить их для анонимного доступа после установки надстройки.


- Так как данные на сайте надстройки не обходятся индексаторами поиска и не существует способа установки настраиваемых списков или библиотек на хост-сайте, а у размещенных в SharePoint надстроек не может быть удаленных компонентов или приемников событий, пользовательские данные в размещенной в SharePoint надстройке недоступны для поиска.



## Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа
<a name="Configuring"> </a>

Если тестовая установка SharePoint расположена в локальной среде, необходимо выполнить первые две процедуры, представленные ниже, чтобы проверить, доступно ли ваше Надстройка SharePoint анонимным пользователям. Пользователи, устанавливающие ваше Надстройка SharePoint, также должны выполнить эти процедуры для родительского семейства сайтов и веб-приложения любого веб-сайта, на котором установлено ваше Надстройка SharePoint.




> **Важно!**
> Если это возможно, установите Надстройка SharePoint на веб-сайт  *до*  выполнения первых двух процедур. Невозможно установить надстройки на какой-либо веб-сайт в локальном веб-приложении SharePoint, если оно было настроено для анонимного доступа. Если веб-приложение уже настроено для анонимного доступа, то чтобы установить надстройку, необходимо временно отключить анонимный доступ.





### Настройка родительского веб-приложения для анонимного доступа


1. В **центре администрирования** выберите **Управление приложениями** и **Управление веб-приложениями**.


2. (Необязательно) Если вы не хотите разрешать анонимный доступ для существующих веб-приложений SharePoint, создайте новое веб-приложение. (Хотя на форме создания веб-приложения можно разрешить анонимный доступ,  *не используйте соответствующий параметр*  . Анонимный доступ следует включать только *после*  установки Надстройка SharePoint.) Дополнительные сведения см. в статье [Create a web application in SharePoint 2013](http://msdn.microsoft.com/library/121c8d83-a508-4437-978b-303096aa59df.aspx).


3. В списке веб-приложений выберите то, которое необходимо сделать доступным анонимным пользователям, и выберите команду **Поставщики проверки подлинности** на ленте.


4. В открывшейся выноске выберите зону, для которой следует включить анонимный доступ. Как правило, это зона **Интернет** или **По умолчанию**. После этого откроется форма **Изменение проверки подлинности**.


5. Установите флажок **Разрешить анонимный доступ**, если это еще не сделано. Это задает настройку по умолчанию, которую можно отключить для определенных семейств сайтов. Но если не включить данный параметр для веб-приложения, вы не сможете разрешить анонимный доступ для какого-либо семейства сайтов.


6. (Необязательно) Снимите флажок **Требовать разрешения на использование удаленных интерфейсов**. Это позволит коду и скриптам, выполняемым в контексте анонимного пользователя, совершать вызовы клиентской объектной модели SharePoint на каждом семействе сайтов. Невозможно повторно включить это требование для семейств сайтов. Если не установить флажок, по умолчанию анонимные пользователи не смогут получить доступ к клиентским объектным моделям, но вы можете отключить требование (и предоставить доступ) для определенных семейств сайтов.

    > **Примечание**
      > Если вы разрабатываете Надстройки SharePoint для анонимных пользователей, этот параметр имеет значение только для размещенных в SharePoint надстроек. Надстройки SharePoint, размещенные у поставщика и предназначенные для анонимного доступа, используют способ, не зависящий от разрешений пользователей. Дополнительные сведения см. в разделе  [Создание размещенных у поставщика надстроек, доступных анонимным пользователям](#Cloud-hosted) выше.
7. Чтобы закрыть форму, нажмите кнопку **Сохранить**.


8. Когда веб-приложение выделено, выберите **Политика анонимного доступа** на ленте.


9. В форме **Ограничения анонимного доступа** выберите зону и убедитесь, что переключатель **Нет** активирован. Если тестируемому Надстройка SharePoint требуются права на доступ к данным SharePoint, выберите переключатель **Запретить запись**.

    > **Примечание**
      > Если вы разрабатываете Надстройки SharePoint для анонимных пользователей, то это еще один параметр, который имеет значение только для размещенных в SharePoint надстроек. 
10. Если вы создали новое веб-приложение на шаге 2, необходимо создать в нем семейство сайтов.



### Настройка локального семейства сайтов для анонимного доступа


1. На домашней странице семейства сайтов в веб-приложении выберите значок шестеренки и щелкните **Параметры сайта**.


2. В разделе **Пользователи и разрешения** на странице **Параметры сайта** выберите **Разрешения сайта**.


3. Выберите **Анонимный доступ** на ленте.


4. На форме **Анонимный доступ** выберите **Весь веб-сайт** или **Списки и библиотеки** в зависимости от уровня доступа, необходимого для тестируемой надстройки. (Независимо от выбранного параметра анонимные пользователи не смогут получить доступ к списку или библиотеке в размещенной в SharePoint надстройке, если список или библиотека не были отдельно настроены для анонимного доступа. Ниже показано, как это сделать.)


5. Если тестируемой надстройке требуется доступ к клиентской объектной модели SharePoint, убедитесь, что флажок **Требовать разрешения на использование удаленных интерфейсов** *не*  установлен. Если флажок недоступен, это значит, что требование было отключено на уровне веб-приложения, что равносильно снятию флажка. (Как было указано в предыдущей процедуре, если вы разрабатываете Надстройки SharePoint для анонимных пользователей, то этот параметр имеет значение только для размещенных в SharePoint приложений.)



> **Важно!**
> Следующую процедуру можно выполнить на общедоступном веб-сайте в SharePoint Online. (Дополнительные сведения об использовании общедоступных веб-сайтов в Microsoft SharePoint Online см. в статье  [Справка по общедоступному веб-сайту для Office 365](http://office.microsoft.com/ru-ru/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1).) 





### Настройка семейства сайтов SharePoint Online для анонимного доступа


1. Войдите в Office 365 как администратор клиента.


2. На домашней странице семейства сайтов выберите **Сделать веб-сайт общедоступным** рядом с верхним правым углом страницы. Это действие также отключает требование на наличие **разрешения на использование удаленных интерфейсов**.


Если вы разрабатываете размещенную в SharePoint надстройку, которая получает доступ к списку SharePoint, необходимо выполнить указанную ниже процедуру в тестовом семействе сайтов. Пользователи надстройки также должны сделать это на любом веб-сайте, где она установлено. Не существует программного или описательного способа настройки анонимного доступа для списка. Надстройки могут устанавливать настраиваемые списки, но невозможно предварительно настроить анонимный доступ для списков. Настройка выполняется вручную после установки надстройки. Если вы создаете размещенное у поставщика Надстройка SharePoint для анонимных пользователей, эта процедура не требуется.




> **Примечание**
> Данную процедуру невозможно выполнить в семействе сайтов SharePoint Online, поэтому размещенные в SharePoint надстройки, установленные в SharePoint Online и предназначенные для анонимных пользователей, не смогут получать доступ к спискам и библиотекам. 





### Настройка списка или библиотека для анонимного доступа


1. Перейдите к списку или библиотеке, к которым обращается тестируемое Надстройка SharePoint, и откройте **Параметры списка** или **Параметры библиотеки**. Для сайта SharePoint Online необходимо войти в систему в качестве администратора клиента.


2. Выберите **Разрешения для этого списка или библиотеки**.


3. На открывшейся странице выберите **Прекратить наследование разрешений** на вкладке **Разрешения** и нажмите **ОК** в запросе подтверждения.


4. Выберите **Анонимный доступ** на вкладке **Разрешения**.


5. В открывшейся форме **Анонимный доступ** выберите все разрешения, необходимые пользователям Надстройка SharePoint. Вы можете разрешить просмотр, изменение, добавление и удаление элементов. Но невозможно предоставить полный доступ, чтобы анонимные пользователи не могли изменить схему или параметры списка.



## Дополнительные ресурсы
<a name="bk_addresources"> </a>


-  [Разработка надстроек для SharePoint](develop-sharepoint-add-ins.md)



