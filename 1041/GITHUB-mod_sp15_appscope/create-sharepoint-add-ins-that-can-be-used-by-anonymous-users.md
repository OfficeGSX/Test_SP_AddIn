---
title: 匿名ユーザーが使用可能な SharePoint アドインを作成する
ms.prod: SHAREPOINT
ms.assetid: e858fce6-7a8f-4b1e-b053-64dc75345801
---


# 匿名ユーザーが使用可能な SharePoint アドインを作成する
一般向けの Microsoft SharePoint 2013 サイトで匿名ユーザーが使用できる SharePoint アドインを作成する方法について説明します。
> **重要**
> この記事で社内 SharePoint 2013 に言及する場合、SharePoint 2013 Service Pack 1 がインストールされていることが前提となります。 
  
    
    


## 匿名でアクセス可能な SharePoint アドインを作成するための前提条件

匿名アクセスは SharePoint ホスト型およびプロバイダー ホストホスト型の SharePoint アドインで可能です。作成するタイプに応じて、以下の前提条件のどちらかを確認してください。
  
    
    

-  [](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md#SP15SPhostedapps_bk_prereqs)
    
  
-  [](get-started-creating-provider-hosted-sharepoint-add-ins.md#SP15createselfhostapp_bk_prereq)
    
  
匿名アクセス用に構成するテスト SharePoint 2013 インストールには、サイト コレクションも必要になります。Office 365 開発者向けサイト を使用している場合は、そのサイトに関連付けられた、特別なパブリック Web サイトのサイト定義を使用するパブリック サイト コレクションが既にあります。(Microsoft SharePoint Online でのパブリック Web サイトの使用の詳細については、 [Office 365 のパブリック Web サイト ヘルプ](http://office.microsoft.com/ja-jp/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1)」を参照してください。) そのサイト定義は社内 SharePoint 2013 インストールでは使用できません。そのため、テスト インストールが社内環境にある場合は、以下が必要になります。
  
    
    

- 匿名アクセスを許可するように構成された SharePoint Web アプリケーション。ただし、この構成は、テストする SharePoint アドインをインストールした後で行う必要があります。
    
  
- 匿名アクセスを許可するように構成された Web アプリケーション内のサイト コレクション。ただし、この構成は、テストする SharePoint アドインをインストールした後で行う必要があります。
    
  
- アドインが SharePoint ホスト型で SharePoint リストにアクセスする場合は、匿名アクセス用に構成されたサイト コレクション内のリスト。
    
  
これらのタスクの説明は、「 [SharePoint Web アプリケーションとサイト コレクションおよび匿名アクセスのリストの構成](#Configuring)」のセクションにあります。
  
    
    

## 匿名ユーザーによる SharePoint アドインの使用の制限

SharePoint アドインを設計するときは、次の事実を考慮してください。
  
    
    

- SharePoint アドイン を SharePoint から起動する場合は、アドインにカスタム アクションまたはアドイン パーツを組み込むか、そうでない場合はページ内のカスタム リンクから起動するようにしなければなりません。匿名ユーザーはタイルからアドインを起動できないためです。タイルからアドインを起動するメカニズムでは、匿名ユーザーがアクセスすることができない特別な [アプリケーション ページ](http://msdn.microsoft.com/library/685c8e01-b163-4b5e-888c-421d9ecbb25e%28Office.15%29.aspx)を使用することになっています。別の方法として、アドインを SharePoint の外部から起動できるようにすることができます。この場合は、アドイン専用の承認ポリシーを使用する必要があります。
    
  
- 匿名ユーザーは、他のユーザーによってインストールされた SharePoint アドイン を起動することしかできません。匿名ユーザーは [ **アドインの追加**] ページを開くことができないためです。
    
  
- ログイン ユーザーが、匿名アクセスができるように構成されたオンプレミス SharePoint Web アプリケーションの Web サイトに移動すると、そのユーザーの ID は「 **システム アカウント** 」に変更されます。この ID では SharePoint アドイン をインストールできません。匿名ユーザーもアドインをインストールすることはできないので、結論として、Web アプリケーションで匿名アクセスが有効になっている場合には、だれも SharePoint アドイン をインストールできないことになります。したがって、SharePoint アドイン は、Web アプリケーションで匿名アクセスを有効にする前に、SharePoint Web アプリケーション内の Web ページにインストールするようにします。後から他のアドインをインストールする必要が生じた場合には、ログイン ユーザーがそのアドインをインストールできるように Web アプリケーションで匿名アクセスを一時的に無効にする必要があります。
    
  
- 社内 SharePoint Web サイトで SharePoint 検索 REST API を有効にするには、いくつかのクエリ XML を構成する必要があります。詳細については、「 [匿名検索 REST クエリを有効にする](http://msdn.microsoft.com/library/office/jj163876.aspx#bk_AnonymousREST)」を参照してください。
    
  
- アドイン Web のデータは検索インデクサーによってクロールされないため、カスタム データはリモートまたはホスト Web に配置する必要があります。このことはすべての SharePoint アドイン に該当しますが、匿名アクセス用のアドインでは検索機能が必要となることが多いので、ここで特に言及しています。
    
  

## プロバイダー向けのホスト型の、匿名でアクセス可能なアドインの作成
<a name="Cloud-hosted"> </a>

プロバイダー向けのホスト型アドインを匿名ユーザーからアクセスできるようにするといっても、それは単にアドインをアドイン専用の承認ポリシーを使用するように構成するだけのことです。このポリシーを使用する場合、SharePoint にはユーザー コンテキストが含まれなくなるので、ユーザーが匿名であるかどうかは問題ではなくなります。ホスト Web に対する適切なアクセス許可 (および親サイト コレクションまたは親テナント機能に対する適切なアクセス許可) がアドインをインストールするテナント管理者によってアドイン プリンシパルに付与されていることだけが必要となります。アドイン マニフェストでホスト Web に対するアクセス許可を要求する方法は、他のアドインの場合と同様です。
  
    
    

> **メモ**
> 匿名ユーザーによる SharePoint サイトへのアクセスが可能である場合、通常は HTTPS アクセスではなく HTTP アクセスが許可されます。このシナリオのアドインにアドイン専用ポリシーが使用されている場合は、セキュリティの問題が発生する可能性があります。アドインの移行に関する詳細およびその方法については、「 [SharePoint アドイン、CSOM、および匿名公開サイトについて開発者各自が知っておくべきこと](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx)」を参照してください。 
  
    
    

アドイン専用ポリシーを使用するようにアドインを設計する場合には、次の 2 つのことが必要です。
  
    
    

- アドイン マニフェストの **AppPermissionRequests** 要素に `AllowAppOnlyPolicy="true"` を追加する必要があります。
    
  
- 使用するコードが OAuth 承認サーバーにアドイン専用のアクセス トークンを要求する必要があります。マネージ コードを使用して作業している場合、この目的のために特に作成された API が、Microsoft Office Developer Tools for Visual Studio によって作成されるコード ファイル (SharePointContext.cs (または .vb) および TokenHelper.cs (または .vb)) 内にあります。
    
  
アドイン専用ポリシー (およびコード スニペット)、アドインのアクセス許可、およびアドイン マニフェストの詳細については、以下のトピックを参照してください。
  
    
    

-  [SharePoint 2013 のアドイン承認ポリシーの種類](add-in-authorization-policy-types-in-sharepoint-2013.md)
    
  
-  [SharePoint 2013 でのアドインのアクセス許可](add-in-permissions-in-sharepoint-2013.md)
    
  
-  [SharePoint アドインのアプリ マニフェスト構造とパッケージを調べる](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in.md)
    
  

## SharePoint ホスト型の、匿名でアクセス可能なアドインの作成
<a name="SP-hosted"> </a>

SharePoint ホスト型の、匿名ユーザーが実行することのできるアドインを作成するために、特別な技術は必要ありません。他の SharePoint ホスト型アドインを作成する場合と同じ方法で作成します。詳細については、「 [SharePoint ホスト型の SharePoint アドインの作成を始める](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md)」および「 [SharePoint 2013 の JavaScript ライブラリ コードを使用して基本的な操作を完了する](complete-basic-operations-using-javascript-library-code-in-sharepoint-2013.md)」を参照してください。
  
    
    
SharePoint ホスト型アドインを匿名アクセスで使用できるようにする場合に極めて重要なことは、SharePoint Online サイト コレクションで匿名アクセスを許可する構成は、テナント管理者によって行われるということです。SharePoint ホスト型アドインの開発者の立場では、この構成をアドイン、リモート アドイン イベント レシーバー、または SharePoint アドイン インストール インフラストラクチャから行うことができません。カスタム リストまたはライブラリをアドインに組み込むことは可能ですが、Collaborative Application Markup Language (CAML) で匿名アクセスのための事前の構成を行うことはできないため、この構成は、アドインをインストールした後に行わなければなりません。
  
    
    
Office ストアでアドインを販売していて、顧客となる可能性のあるユーザーのかなり多くが、アドインに匿名ユーザーでアクセスできると非常に便利だと感じているとしたら、アドインの説明でこの構成要件について言及することを検討してください。また、アドインのサポート ページに、後述の「 **SharePoint Online サイト コレクションを匿名アクセス用に構成するには** 」の手順を含めることも検討してください。
  
    
    
アドインが SharePoint の JavaScript オブジェクト モデル (JSOM) を使用する場合は、非常に重要な構成要件が 1 つあります。既定では、匿名ユーザーがアクセスできる JSOM API は非常に少数にすぎません。それ以外のすべての API には、ユーザーが [ **リモート インターフェイスの使用** ] アクセス許可を持っていることが必要で、匿名ユーザーにはこのアクセス許可がありません。この要件は、「 [SharePoint Web アプリケーションとサイト コレクションおよび匿名アクセスのリストの構成](#Configuring)」に説明されている方法に従って、アドインがインストールされている Web サイトの親サイト コレクションまたは親 SharePoint Web アプリケーションで無効にする必要があります。
  
    
    

> **メモ**
> ユーザーが [ **リモート インターフェイスの使用** ] アクセス許可を持つという要件を無効にするということは、情報プライバシーに影響を及ぼします。詳細については、「 [SharePoint アドイン、CSOM、および匿名公開サイトについて開発者各自が知っておくべきこと](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx)」を参照してください。 
  
    
    


## SharePoint ホスト型アドインの匿名ユーザーに対する制限
<a name="SP-hosted"> </a>

正直なところ、SharePoint ホスト型アドインには、匿名ユーザーに対していくつかの注意を要する重要な制限があります。
  
    
    

- SharePoint Online 上のリストやライブラリを、匿名ユーザーからアクセス可能にすることはできません。したがって、リストやライブラリとの対話を行う JSOM API は、SharePoint Online では匿名ユーザー用に動作しません。
    
  
- オンプレミスの SharePoint Web サイトにインストールされた SharePoint ホスト型アドインは、すべての JSOM API を利用できます。しかし、Web アプリケーション、サイト コレクション、およびリスト/ライブラリは手動で匿名アクセス用に構成する必要があり、[ **リモート インタフェースの使用** ] アクセス許可の要件は無効にする必要があります。アドインによってカスタム リスト/ライブラリがアドイン Web にインストールされる場合は、アドインをインストールした後に、ユーザー自身がそれらのリストやライブラリを匿名アクセス用に手動で構成することになります。
    
  
- アドイン Web 上のデータは検索インデクサーでクロールされず、カスタム リストやライブラリをホスト Web にインストールする方法がなく、さらに SharePoint ホスト型アドインにはリモート コンポーネントもイベント レシーバーもないため、SharePoint ホスト型アドインのカスタム データは検索不能です。
    
  

## SharePoint Web アプリケーションとサイト コレクションおよび匿名アクセスのリストの構成
<a name="Configuring"> </a>

SharePoint のテスト インストール環境が社内に設置されている場合は、SharePoint アドインを匿名ユーザーが使用できるかどうかをテストするために、以下の最初の 2 つの手順を実行する必要があります。SharePoint アドインをインストールする顧客も、SharePoint アドインがインストールされている Web サイトの親サイト コレクションおよび親 Web アプリケーションに対してそれらの手順を実行する必要があります。
  
    
    

> **重要**
> 可能であれば、最初の 2 つの手順を実行する前に、SharePoint アドイン を Web サイトにインストールしてください。オンプレミスの SharePoint Web アプリケーションで匿名アクセスが有効になっている場合には、アドインをその Web アプリケーションにインストールすることはできません。Web アプリケーションですでに匿名アクセスが有効になっている場合、アドインをインストールするには、一時的にその設定を元に戻す必要があります。 
  
    
    


### 親 Web アプリケーションを匿名アクセス用に構成するには


1. [ **サーバーの全体管理**] で、[ **アプリケーション構成の管理**] を選択してから、[ **Web アプリケーションの管理**] を選択します。
    
  
2. (オプション) 既存のどの SharePoint Web アプリケーションへも匿名アクセスを許可しない場合は、新しい Web アプリケーションを作成します。(Web アプリケーション作成フォームには匿名アクセスを許可するオプションがありますが、このオプションは使用しないでください。SharePoint アドインのインストール後まで、匿名アクセスを有効にしないでください。) 詳細については、「 [Create a web application in SharePoint 2013](http://msdn.microsoft.com/library/121c8d83-a508-4437-978b-303096aa59df.aspx)」を参照してください。
    
  
3. Web アプリケーションのリストで、匿名ユーザーによるアクセスを可能にする Web アプリケーションを選択し、リボンの [ **認証プロバイダー**] を選択します。
    
  
4. 吹き出しが開いたら、匿名アクセスを有効にするゾーンを選択します。通常は [ **インターネット**] または [ **既定**] です。[ **認証の編集**] フォームが開きます。
    
  
5. [ **匿名アクセスの有効化**] ボックスがまだ有効になっていない場合は、このボックスをチェックします。このように既定を設定しても、特定のサイト コレクションでオフにすることができますが、これを Web アプリケーションに対して有効にしていないなら、どのサイト コレクションに対してもこの設定を有効にすることはできません。
    
  
6. (オプション) [ **"リモート インターフェイスの使用" 権限を必須にする**] ボックスのチェックを解除します。こうすることで、匿名ユーザーのコンテキストで実行するコードとスクリプトが、すべてのサイト コレクションにある SharePoint のクライアント オブジェクト モデルへの呼び出しを行えるようになります。どのサイト コレクションに対しても、この要件を再度有効にすることはできません。このボックスをチェックしたままにすることは、既定で匿名ユーザーはクライアントオブジェクト モデルにアクセスできないが、特定のサイト コレクションに対してこの要件を無効に (して匿名ユーザーにアクセス権を付与) できることを意味します。
    
    > **メモ**
      > 匿名ユーザー用の SharePoint アドイン を開発するという状況では、この設定は SharePoint ホスト型アドインに対してのみ意味があります。プロバイダー向けのホスト型の、匿名ユーザー向けに設計された SharePoint アドイン では、ユーザーのアクセス許可を無視する技術が使用されています。このことに関する詳細については、上の「 [プロバイダー向けのホスト型の、匿名でアクセス可能なアドインの作成](#Cloud-hosted)」のセクションを参照してください。 
7. [ **保存**] を選択して、フォームを閉じます。
    
  
8. Web アプリケーションが強調表示された状態で、リボンの [ **匿名ポリシー**] を選択します。
    
  
9. [ **匿名アクセス制限**] フォームで、ゾーンを選択して、 [ **なし**] ラジオ ボタンが選択されていることを確認します。テスト中の SharePoint アドインに SharePoint データへの読み取り権限のみが必要な場合は、その代わりに [ **書き込みの拒否**] を有効にします。
    
    > **メモ**
      > 匿名ユーザー用の SharePoint アドイン を開発している状況では、この設定も SharePoint ホスト型アドインにのみ意味がある設定です。 
10. ステップ 2 で新しい Web アプリケーションを作成した場合は、その中にサイト コレクションを作成する必要があります。
    
  

### 社内サイト コレクションを匿名アクセス用に構成するには


1. Web アプリケーション内のサイト コレクションのホーム ページで、歯車アイコンを選択して、[ **サイトの設定**] を選択します。
    
  
2. [ **サイトの設定**] ページの [ **ユーザーと権限**] セクションで、[ **サイトの権限**] を選択します。
    
  
3. リボンの [ **匿名アクセス**] を選択します。
    
  
4. [ **匿名アクセス**] フォームで、テスト中のアドインが必要とするアクセスのレベルに応じて、[ **Web サイト全体**] または [ **リストとライブラリ**] のいずれかを選択します。(どちらのオプションを選択するかに関わりなく、ライブラリのリストがすべての匿名アクセス用に個別に構成されている場合を除き、匿名ユーザーは SharePoint ホスト型アドインでリストまたはライブラリにアクセスすることはできません。個別に構成する手順を、以下に説明します。
    
  
5. テスト中のアドインが SharePoint クライアント オブジェクト モデルへのアクセスを必要とする場合、[ **"リモート インターフェイスの使用" 権限を必須にする**] ボックスがチェックされていないことを確認します。このチェックボックスがグレー表示されている場合、この要件は Web アプリケーション レベルで無効にされています。これは、ボックスのチェックが解除されているのと同じ状態です。(一つ前の手順で説明されているように、匿名ユーザー用に SharePoint アドイン を開発するという状況で、この設定は SharePoint ホスト型アドインに対してのみ意味があります。)
    
  

> **重要**
> 以下の手順は、SharePoint Online のパブリック Web サイトでのみ実行できます。(Microsoft SharePoint Online でのパブリック Web サイトの使用の詳細については、「 [パブリック Web サイトのヘルプ (Office 365 用)](http://office.microsoft.com/ja-jp/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1)」を参照してください。) 
  
    
    


### SharePoint Online サイト コレクションを匿名アクセス用に構成するには


1. テナント管理者として Office 365 にログインします。
    
  
2. サイト コレクションのホーム ページで、ページの右上隅にある [ **Web サイトをオンラインにする**] を選択します。この操作により、[ **"リモート インターフェイスの使用" 権限** ] 要件がオフになります。
    
  
SharePoint ホスト型アドインを開発中で、そのアドインが SharePoint リストにアクセスする場合、テスト サイト コレクションで以下の手順も実行する必要があります。アドインを使用する顧客も、アドインをインストールするすべての Web サイトで同じ手順を実行することが必要です。アドインがプログラムや構成内容の記述によって匿名アクセス用のリストを構成することはできません。アドインはカスタム リストをインストールできますが、匿名アクセス用にそのようなリストを事前に構成する方法はありません。この構成もやはりアドインのインストール後に手動で行う必要があります。プロバイダー向けのホスト型の、匿名ユーザー用の SharePoint アドイン を開発している場合には、この手順は必要ありません。
  
    
    

> **メモ**
> この手順は SharePoint Online サイト コレクションで実行できないため、SharePoint Online にインストールされ匿名ユーザーによって使用される SharePoint ホスト型アドインは、リストやライブラリにアクセスできません。 
  
    
    


### リストおよびライブラリを匿名アクセス用に構成するには


1. テスト中の SharePoint アドインがアクセスするリストまたはライブラリに移動して、[ **リストの設定**] または [ **ライブラリの設定**] を開きます。SharePoint Online サイトの場合は、テナント管理者としてログインする必要があります。
    
  
2. [ **このリスト/ライブラリの権限**] を選択します。
    
  
3. 開いたページの [ **権限**] タブで [ **権限の継承を中止**] を選択してから、確認のプロンプトで [ **OK**] を選択します。
    
  
4. [ **アクセス権**] タブで [ **匿名アクセス**] を選択します。
    
  
5. 開いた [ **匿名アクセス**] フォームで、SharePoint アドインのユーザーに必要なすべての権限を選択します。アイテムを表示、挿入、編集、削除する権限を付与できます。[フル コントロール] を付与することはできないので、匿名ユーザーはリストのスキーマを変更したり、リスト設定を変更したりすることはできません。
    
  

## その他の技術資料
<a name="bk_addresources"> </a>


-  [SharePoint アドインの開発](develop-sharepoint-add-ins.md)
    
  

