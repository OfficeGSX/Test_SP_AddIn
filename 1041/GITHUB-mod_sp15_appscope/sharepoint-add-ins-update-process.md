---
title: SharePoint アドインの更新プロセス
ms.prod: SHAREPOINT
ms.assetid: 3dba209d-cb98-4e5d-b4b2-fad31e667ca1
---


# SharePoint アドインの更新プロセス
SharePoint アドインを更新するプロセスについて説明します。
SharePoint アドインに機能の追加、バグの修正、セキュリティ更新プログラムの適用を行ったときは、アドインを更新する必要があります。アドインに対する更新は、アドインの最初のバージョンが展開されるときと同様に、SharePoint アドイン パッケージで展開されます。SharePoint アドインの更新プロセスでは、なんらかの理由で更新が失敗した場合でも、アドインのデータは確実に保持されます。





> **重要**
> 更新システムを使用して *アドインの種類*  を変更することはできません。 たとえば、更新プログラムによって SharePoint によってホストされるアドインからプロバイダーでホストされるアドインに変更することはできません。 種類を変更するには、 [古いアドインを新しいアドインに移行する必要があります](#Major)。特に、 [自動ホスト型アドインのプレビュー プログラムの提供は終了](http://blogs.office.com/2014/05/16/update-on-autohosted-apps-preview-program/)したので、自動ホスト型アドインをプロバイダー向けのホスト型アドインに更新できなくなったことにご注意ください。該当するアドインは、「 [自動ホスト型 SharePoint アドインをプロバイダー向けのホスト型アドインに変換する](convert-an-autohosted-sharepoint-add-in-to-a-provider-hosted-add-in.md)」で説明されているように変換する必要があります。 





## SharePoint アドインの更新プロセス
<a name="Minor"> </a>

更新では、アドイン マニフェストで、元のバージョンに使用したのと同じプロダクト ID を使用します。アドイン マニフェスト内のバージョン番号は、元のアドインまたは最新の更新プログラムのバージョン番号よりも大きい必要があります。



組織のアドイン カタログに更新プログラムをアップロードしてから 24 時間以内、および Office ストアにアップロードしてから 1 週間以内に、更新プログラムが利用可能なことを示すインジケーターが、アドインがインストールされているすべての Web サイトの [ **サイト コンテンツ**] ページで、アドインのリストの横に表示されます。図 1 に示すように、ユーザーはリンクをクリックしてアドインを更新できます。利用可能な更新プログラムはテナント管理 UI にも表示されます。




**図 1. SharePoint 用アドインのアップグレード プロセス**








![アプリを更新するための UI 上の手順](images/UpdatingApp_AppTileUpdateNotice.png)





> **ヒント**
>  更新プログラムの開発時には、新しいバージョンをアップロードして SharePoint アドイン カタログをテストするのに毎回 24 時間待つのは不便です。アドインをすぐに更新する方法については、「 [24 時間待たずにアドインを更新する](update-sharepoint-add-ins.md#ImmediateUpdateNotice)」を参照してください。 <BR />  既定では、SharePoint はインストール済みアドインに対する更新プログラムを 24 時間ごとに確認します。ファーム管理者は、次の SharePoint 管理シェル コマンドを使用してこれを別の値に設定できます。ここで、n はチェックの間隔の時間です。<BR />  `Set-SPInternalAppStateUpdateInterval -AppStateSyncHours n`<BR />  この値を 0 に設定すると、組み込みのタイマー ジョブ [ **内部アドインの状態の更新**] が実行されるたびにチェックが行われます。既定では 1 時間ごとに実行されます。ファーム管理者はサーバーの全体管理を使用して、タイマー ジョブの間隔を変更したり、すぐに実行したりできます。 




SharePoint 2013 は、ユーザーが SharePoint アドインに更新プログラムをインストールした場合、次のことを行います。これらのイベントは必ずこの順序で発生するとは限らず、一部の処理は並行して発生することがあります。また、更新が失敗した場合は完全なロールバックが実行されます。




- SharePoint 2013 は、アドインによって要求されたアクセス許可を承認するように求めるメッセージをユーザーに表示します。


- SharePoint 2013 は、一時的にユーザーがアドインを利用できないようにします。


- アドインに SharePoint ソリューション パッケージ (.wsp) が含まれている場合、ソリューション パッケージの内容が変更されると、SharePoint は次のことを行います。

  - アドイン Web のバックアップを作成します。 (ただし SharePoint Online とオンプレミスの SharePoint 2016 以降では、SharePoint のリスト内の実際のデータは、更新によってリストのスキーマが変更される場合にのみバックアップされます。)


  - バックアップの更新をテストします。


  - テストが成功した場合は、元のアドイン Web を更新します。アドイン パッケージ内の新しい .wsp ファイルは、アドイン Web の Features や他の要素を更新するために使われます (Feature スキーマの更新の部分は SharePoint 2013 で拡張されています)。


- SharePoint 2013 は、アドイン マニフェストに登録されている場合、 **UpgradedEventEndpoint** Web サービスを実行します。

    > **メモ**
    > アドインがプロバイダーでホストされる場合は、アドインを構成する SharePoint 以外のすべてのコンポーネント用の更新ロジックを用意してください。ほとんどの部分については、それらのコンポーネントをアドインのインストールとは別にインストールしたように、SharePoint アドイン自体の更新とは別にこれらのコンポーネントを更新します。ただし、ユーザーが SharePoint アドインを更新するときにのみ発生する変更もあります。このロジックは、 **UpgradedEventEndpoint** Web サービス内やアドイン自体の "更新後の初回実行" ロジック内に配置できます。
- SharePoint 2013 は、アドインとそのコンポーネントを再度利用できるようにします。




> **メモ**
> アドイン Web 内のリストのスキーマが変更されている場合、そのリストはアドイン Web の他の部分と共にバックアップされます。リスト内に多くのデータがある場合には、この処理に時間がかかることがあります。更新処理が 1 時間で完了しない場合、処理は停止して更新がロールバックされます。 





## 古いアドインから新しいアドインへの移行
<a name="Major"> </a>

シナリオによっては、元のアドインを更新するのではなく、完全に新しいアドインを作成して古いアドインを置き換えることが必要な場合があります。新しいアドインには古いアドインと同じフレンドリ名を付けることができますが、プロダクト ID はアドイン マニフェストで新しく指定する必要があります。新しいアドインは、Office ストアや SharePoint Web サイトの [ **アドインの追加**] ページに、元のバージョンとは異なるアイテムとして表示されます。




> **メモ**
> 組織のアドイン カタログの項目は、製品 ID またはアドインの名前ではなく、アドイン パッケージの *ファイル名*  によって区別されます。新しいアドインに、古いアドインと同じパッケージ ファイル名がある場合、アドイン カタログの古いアドインが置き換えられ、古いアドインは [ **アドインの追加**] ページには表示されなくなります。カタログにアップロードするときにアドイン パッケージでバージョン管理を有効にする場合、ファイルの古いバージョン (古いアドイン) は項目の履歴に引き続き表示されます。古いアドイン パッケージをダウンロードしたり、そのパッケージに戻ることができますが、別のファイル名が付けられていない限り、古いアドインと新しいアドインをカタログまたは [ **アドインの追加**] ページで個別の項目として表示する方法はありません。 




場合によっては、データを移行することが必要になります。たとえば、新しいアドインで、古いアドインとは異なるスキーマの Microsoft Azure SQL データベースを使用している場合があります。または、新しいアドインで異なるデータ格納メカニズムを使用している場合もあります (たとえば、SharePoint リストの代わりに外部データベース)。このような場合は、データ移行のためのコードを用意する必要があります。



古いデータが、リモート イベント ハンドラーによってアクセスできる場所にある場合は、新しいアドインの **InstalledEventEndpoint** Web サービスに移行ロジックを実装できます。または、新しいアドインから古いデータにアクセスできる場合は、ユーザーが新しいアドインを起動して最初に実行されるコード内に移行ロジックを配置できます。古いデータがリモート ハンドラーからも新しいアドインからもアクセスできない場合は、古いアドインのアップグレードを作成して、データ エクスポート機能とその機能用の UI を追加できます。ユーザーは、最初に古いアドインを更新してから、そのアドインを使って新しいアドインからアクセスできる場所にデータをエクスポートします。新しいアドインにデータをインポートするための機能と UI を開発者が組み込みます。



原則として、古いアドインで使用されていた外部データ ソース、計算コンポーネント、またはその他の外部コンポーネントを新しいアドインで再利用できます。ただし、SharePoint アドインをアンインストールすると、SharePoint 2013 インフラストラクチャは、インフラストラクチャがインストールしたすべてのものをアンインストールします。したがって、SharePoint アドインでは一般的に、アドイン自身がインストールしたコンポーネントか、SharePoint 2013 インフラストラクチャでインストールされたのではない外部コンポーネントのみを使用することをお勧めします。




> **メモ**
> コンポーネントをインストールする **InstalledEventEndpoint**または **UpgradedEventEndpoint**を実装する場合、同じコンポーネントをアンインストールする **UninstallingEventEndpoint**も実装することをお勧めします。そうすることで、アドインは自己完結型で、クリーンにアンインストールされるという設計原則に準拠できます。ただし、アドインのアンインストール後もユーザーにとって有益なデータは削除しないでください。アドインによって作成された Web サイトは、アドイン Web 以外は、通常はデータと見なす必要があります。 




古いアドインと新しいアドインのそれぞれにアドイン Web が含まれている場合は、新しいアドイン Web は新しいアドインのインストール時に作成されることを考慮してください。このため、SharePoint 2013 の Feature スキーマでは更新に関連した XML マークアップを使わないでください。その種のマークアップは既存の SharePoint コンポーネントを更新しないと機能しません。古いアドインを新しいアドインに置き換えます。




## その他の技術情報
<a name="SP15appupgrade_addlresources"> </a>


-  [SharePoint アドインを更新する](update-sharepoint-add-ins.md)


-  [SharePoint 2013 でアドイン Web コンポーネントを更新する](update-add-in-web-components-in-sharepoint-2013.md)


-  [SharePoint 2013 でホスト Web コンポーネントを更新する](update-host-web-components-in-sharepoint-2013.md)


-  [SharePoint アドインで更新イベント用のハンドラーを作成する](create-a-handler-for-the-update-event-in-sharepoint-add-ins.md)


-  [SharePoint アドインのリモート コンポーネントを更新する](update-remote-components-in-sharepoint-add-ins.md)


-  [SharePoint アドインの発行](publish-sharepoint-add-ins.md)


-  [SharePoint アドインのアーキテクチャおよび開発環境に関する重要な要素](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscap.md)


-  [SharePoint アドインの展開とインストール: 方法とオプション](deploying-and-installing-sharepoint-add-ins-methods-and-options.md)



